# Pipeline Configuration
# Defines automated handoffs between agents

# Format:
# [trigger_type].[trigger_status] -> [new_type].[assignee]

pipelines:
  # Feature Development Pipeline
  feature:
    - trigger: { status: done }
      create:
        type: test
        title_prefix: "Test:"
        assignee: tester
        priority: inherit
        parent: trigger
        note: "Verify implementation from {trigger_id}"
    
  # Test Pipeline  
  test:
    - trigger: { status: done, label: passed }
      create:
        type: review
        title_prefix: "Review:"
        assignee: reviewer
        priority: inherit
        parent: trigger.parent
        refs: [trigger]
        note: "Tests passed. Review for merge."
    
    - trigger: { status: done, label: failed }
      create:
        type: bug
        title_prefix: "Fix:"
        assignee: developer
        priority: 1
        parent: trigger.parent
        note: "Tests failed. See {trigger_id} for details."

  # Review Pipeline
  review:
    - trigger: { status: done, label: approved }
      create:
        - type: integration
          title_prefix: "Merge:"
          assignee: integrator
          priority: 1
          parent: trigger.parent
          refs: [trigger]
    
    - trigger: { status: done, label: changes-requested }
      update:
        target: trigger.parent
        status: in-progress
        note: "Review requested changes. See {trigger_id}."

  # Bug Fix Pipeline (fast-track)
  bug:
    - trigger: { status: done, priority: 1 }
      create:
        type: integration
        title_prefix: "Hotfix:"
        assignee: integrator
        priority: 1
        parent: trigger
        note: "P1 bug fix - fast track to main"
    
    - trigger: { status: done, priority: [2,3,4,5] }
      create:
        type: test
        title_prefix: "Test fix:"
        assignee: tester
        priority: inherit
        parent: trigger

  # Integration Pipeline
  integration:
    - trigger: { status: done }
      update:
        target: trigger.parent
        status: done
        note: "Merged and deployed via {trigger_id}"
      notify: "ðŸš€ {trigger.parent.title} shipped!"

  # Refactor Pipeline (from architect)
  refactor:
    - trigger: { status: done }
      create:
        type: test
        title_prefix: "Test refactor:"
        assignee: tester
        priority: 2
        parent: trigger
        note: "Verify refactor didn't break anything"

  # Design Review Pipeline (optional, for UI features)
  design:
    - trigger: { status: done, label: approved }
      update:
        target: trigger.parent
        note: "Design approved. See {trigger_id}."
    
    - trigger: { status: done, label: changes-requested }
      update:
        target: trigger.parent
        status: in-progress
        note: "Design changes requested. See {trigger_id}."

  # Infrastructure Pipeline
  infra:
    - trigger: { status: done }
      create:
        type: test
        title_prefix: "Test infra:"
        assignee: tester
        priority: 2
        parent: trigger
        note: "Verify infrastructure changes with smoke tests"

# Task types and their default assignees
task_types:
  feature: developer
  bug: developer
  test: tester
  review: reviewer
  integration: integrator
  refactor: developer
  architecture: architect

# Labels for pipeline decisions
labels:
  test_result: [passed, failed]
  review_result: [approved, changes-requested, needs-discussion]
  merge_result: [merged, conflict, failed-ci]

# Notification channels (for future integration)
notifications:
  slack_channel: "#dev-pipeline"
  email: false
